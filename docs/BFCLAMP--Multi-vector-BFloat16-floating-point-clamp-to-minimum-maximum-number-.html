<html>
 <head>  <link rel="stylesheet" href="../def-style.css"></head> 
 <body> 
  <h2>BFCLAMP</h2> 
  <p>Multi-vector BFloat16 floating-point clamp to minimum/maximum number</p> 
  <p>Clamp each BFloat16 element in the two or four destination vectors to between the BFloat16 minimum value in the corresponding element of the first source vector and the BFloat16 maximum value in the corresponding element of the second source vector and destructively place the clamped results in the corresponding elements of the two or four destination vectors. If at least one element value contributing to a result is numeric and the other is either numeric or a quiet NaN, then the result is the numeric value.</p> 
  <p>This instruction follows SME2.1 non-widening BFloat16 numerical behaviors corresponding to instructions that place their results in two or four SVE Z vectors.</p> 
  <p>This instruction is unpredicated.</p> 
  <p>ID_AA64SMFR0_EL1.B16B16 indicates whether this instruction is implemented.</p> 
  <p> It has encodings from 2 classes: <a class="document-topic">Two registers</a> and <a class="document-topic">Four registers</a> </p> 
  <h3><a id="iclass_to_2reg"></a>Two registers<span><br></br>(FEAT_B16B16) </span></h3> 
  <div> 
   <table> 
    <thead> 
     <tr> 
      <td>31</td> 
      <td>30</td> 
      <td>29</td> 
      <td>28</td> 
      <td>27</td> 
      <td>26</td> 
      <td>25</td> 
      <td>24</td> 
      <td>23</td> 
      <td>22</td> 
      <td>21</td> 
      <td>20</td> 
      <td>19</td> 
      <td>18</td> 
      <td>17</td> 
      <td>16</td> 
      <td>15</td> 
      <td>14</td> 
      <td>13</td> 
      <td>12</td> 
      <td>11</td> 
      <td>10</td> 
      <td>9</td> 
      <td>8</td> 
      <td>7</td> 
      <td>6</td> 
      <td>5</td> 
      <td>4</td> 
      <td>3</td> 
      <td>2</td> 
      <td>1</td> 
      <td>0</td> 
     </tr> 
    </thead> 
    <tbody> 
     <tr> 
      <td>1</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>1</td> 
      <td colspan="5">Zm</td> 
      <td>1</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td colspan="5">Zn</td> 
      <td colspan="4">Zd</td> 
      <td>0</td> 
     </tr> 
     <tr> 
      <td colspan="8"></td> 
      <td>size&lt;1&gt;</td> 
      <td>size&lt;0&gt;</td> 
      <td></td> 
      <td colspan="5"></td> 
      <td colspan="6"></td> 
      <td colspan="5"></td> 
      <td colspan="4"></td> 
      <td></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div> 
   <h4></h4> 
   <a id="bfclamp_mz_zz_2"></a> 
   <p>BFCLAMP { <a title="First destination scalable vector register of a multi-vector sequence (field Zd)" class="document-topic">&lt;Zd1&gt;</a>.H-<a title="Second destination scalable vector register of a multi-vector sequence (field Zd)" class="document-topic">&lt;Zd2&gt;</a>.H }, <a title="First source scalable vector register (field &quot;Zn&quot;)" class="document-topic">&lt;Zn&gt;</a>.H, <a title="Second source scalable vector register (field &quot;Zm&quot;)" class="document-topic">&lt;Zm&gt;</a>.H</p> 
  </div> 
  <pre>if !<a title="function: boolean HaveSMEB16B16()" class="document-topic">HaveSMEB16B16</a>() then UNDEFINED;
integer n = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zn);
integer m = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zm);
integer d = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zd:'0');
constant integer nreg = 2;</pre> 
  <h3><a id="iclass_to_4reg"></a>Four registers<span><br></br>(FEAT_B16B16) </span></h3> 
  <div> 
   <table> 
    <thead> 
     <tr> 
      <td>31</td> 
      <td>30</td> 
      <td>29</td> 
      <td>28</td> 
      <td>27</td> 
      <td>26</td> 
      <td>25</td> 
      <td>24</td> 
      <td>23</td> 
      <td>22</td> 
      <td>21</td> 
      <td>20</td> 
      <td>19</td> 
      <td>18</td> 
      <td>17</td> 
      <td>16</td> 
      <td>15</td> 
      <td>14</td> 
      <td>13</td> 
      <td>12</td> 
      <td>11</td> 
      <td>10</td> 
      <td>9</td> 
      <td>8</td> 
      <td>7</td> 
      <td>6</td> 
      <td>5</td> 
      <td>4</td> 
      <td>3</td> 
      <td>2</td> 
      <td>1</td> 
      <td>0</td> 
     </tr> 
    </thead> 
    <tbody> 
     <tr> 
      <td>1</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>0</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>1</td> 
      <td colspan="5">Zm</td> 
      <td>1</td> 
      <td>1</td> 
      <td>0</td> 
      <td>0</td> 
      <td>1</td> 
      <td>0</td> 
      <td colspan="5">Zn</td> 
      <td colspan="3">Zd</td> 
      <td>0</td> 
      <td>0</td> 
     </tr> 
     <tr> 
      <td colspan="8"></td> 
      <td>size&lt;1&gt;</td> 
      <td>size&lt;0&gt;</td> 
      <td></td> 
      <td colspan="5"></td> 
      <td colspan="6"></td> 
      <td colspan="5"></td> 
      <td colspan="3"></td> 
      <td colspan="2"></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div> 
   <h4></h4> 
   <a id="bfclamp_mz_zz_4"></a> 
   <p>BFCLAMP { <a title="First destination scalable vector register of a multi-vector sequence (field Zd)" class="document-topic">&lt;Zd1&gt;</a>.H-<a title="Fourth destination scalable vector register of a multi-vector sequence (field Zd)" class="document-topic">&lt;Zd4&gt;</a>.H }, <a title="First source scalable vector register (field &quot;Zn&quot;)" class="document-topic">&lt;Zn&gt;</a>.H, <a title="Second source scalable vector register (field &quot;Zm&quot;)" class="document-topic">&lt;Zm&gt;</a>.H</p> 
  </div> 
  <pre>if !<a title="function: boolean HaveSMEB16B16()" class="document-topic">HaveSMEB16B16</a>() then UNDEFINED;
integer n = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zn);
integer m = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zm);
integer d = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Zd:'00');
constant integer nreg = 4;</pre> 
  <div></div> 
  <h3>Assembler Symbols</h3> 
  <div> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Zd1&gt;</td> 
      <td><a id="sa_zd1"></a> <p>For the two registers variant: is the name of the first destination scalable vector register of a multi-vector sequence, encoded as "Zd" times 2.</p> </td> 
     </tr> 
     <tr> 
      <td></td> 
      <td><a id="sa_zd1_1"></a> <p>For the four registers variant: is the name of the first destination scalable vector register of a multi-vector sequence, encoded as "Zd" times 4.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Zd4&gt;</td> 
      <td><a id="sa_zd4"></a> <p>Is the name of the fourth destination scalable vector register of a multi-vector sequence, encoded as "Zd" times 4 plus 3.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Zd2&gt;</td> 
      <td><a id="sa_zd2"></a> <p>Is the name of the second destination scalable vector register of a multi-vector sequence, encoded as "Zd" times 2 plus 1.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Zn&gt;</td> 
      <td><a id="sa_zn"></a> <p>Is the name of the first source scalable vector register, encoded in the "Zn" field.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Zm&gt;</td> 
      <td><a id="sa_zm"></a> <p>Is the name of the second source scalable vector register, encoded in the "Zm" field.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div></div> 
  <div> 
   <a id="execute"></a> 
   <h3>Operation</h3> 
   <pre><a title="function: CheckStreamingSVEEnabled()" class="document-topic">CheckStreamingSVEEnabled</a>();
constant integer VL = <a title="accessor: integer CurrentVL" class="document-topic">CurrentVL</a>;
constant integer elements = VL DIV 16;
array [0..3] of bits(VL) results;

for r = 0 to nreg-1
    bits(VL) operand1 = <a title="accessor: bits(width) Z[integer n, integer width]" class="document-topic">Z</a>[n, VL];
    bits(VL) operand2 = <a title="accessor: bits(width) Z[integer n, integer width]" class="document-topic">Z</a>[m, VL];
    bits(VL) operand3 = <a title="accessor: bits(width) Z[integer n, integer width]" class="document-topic">Z</a>[d+r, VL];
    for e = 0 to elements-1
        bits(16) element1 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e, 16];
        bits(16) element2 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, e, 16];
        bits(16) element3 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand3, e, 16];
        <a title="accessor: Elem[bits(N) &amp;vector, integer e, integer size] = bits(size) value" class="document-topic">Elem</a>[results[r], e, 16] = <a title="function: bits(16) BFMinNum(bits(16) op1_in, bits(16) op2_in, FPCRType fpcr)" class="document-topic">BFMinNum</a>(<a title="function: bits(16) BFMaxNum(bits(16) op1_in, bits(16) op2_in, FPCRType fpcr)" class="document-topic">BFMaxNum</a>(element1, element3, FPCR[]), element2, FPCR[]);

for r = 0 to nreg-1
    <a title="accessor: Z[integer n, integer width] = bits(width) value" class="document-topic">Z</a>[d+r, VL] = results[r];</pre> 
  </div>  
 </body>
</html>