<html>
 <head>  <link rel="stylesheet" href="../def-style.css"></head> 
 <body> 
  <h2>FCMLA (by element)</h2> 
  <p>Floating-point Complex Multiply Accumulate (by element).</p> 
  <p>This instruction operates on complex numbers that are represented in SIMD&amp;FP registers as pairs of elements, with the more significant element holding the imaginary part of the number and the less significant element holding the real part of the number. Each element holds a floating-point value. It performs the following computation on complex numbers from the first source register and the destination register with the specified complex number from the second source register:</p> 
  <ul> 
   <li>Considering the complex number from the second source register on an Argand diagram, the number is rotated counterclockwise by 0, 90, 180, or 270 degrees.</li> 
   <li>The two elements of the transformed complex number are multiplied by: 
    <ul> 
     <li>The real element of the complex number from the first source register, if the transformation was a rotation by 0 or 180 degrees.</li> 
     <li>The imaginary element of the complex number from the first source register, if the transformation was a rotation by 90 or 270 degrees.</li> 
    </ul></li> 
   <li>The complex number resulting from that multiplication is added to the complex number from the destination register.</li> 
  </ul> 
  <p>The multiplication and addition operations are performed as a fused multiply-add, without any intermediate rounding.</p> 
  <p>This instruction can generate a floating-point exception. Depending on the settings in <em>FPCR</em>, the exception results in either a flag being set in <em>FPSR</em> or a synchronous exception being generated. For more information, see <em>Floating-point exception traps</em>.</p> 
  <p>Depending on the settings in the <em>CPACR_EL1</em>, <em>CPTR_EL2</em>, and <em>CPTR_EL3</em> registers, and the current Security state and Exception level, an attempt to execute the instruction might be trapped.</p> 
  <h3><a id="iclass_2reg_element"></a>Vector<span><br></br>(FEAT_FCMA) </span></h3> 
  <p></p> 
  <div> 
   <table> 
    <thead> 
     <tr> 
      <td>31</td> 
      <td>30</td> 
      <td>29</td> 
      <td>28</td> 
      <td>27</td> 
      <td>26</td> 
      <td>25</td> 
      <td>24</td> 
      <td>23</td> 
      <td>22</td> 
      <td>21</td> 
      <td>20</td> 
      <td>19</td> 
      <td>18</td> 
      <td>17</td> 
      <td>16</td> 
      <td>15</td> 
      <td>14</td> 
      <td>13</td> 
      <td>12</td> 
      <td>11</td> 
      <td>10</td> 
      <td>9</td> 
      <td>8</td> 
      <td>7</td> 
      <td>6</td> 
      <td>5</td> 
      <td>4</td> 
      <td>3</td> 
      <td>2</td> 
      <td>1</td> 
      <td>0</td> 
     </tr> 
    </thead> 
    <tbody> 
     <tr> 
      <td>0</td> 
      <td>Q</td> 
      <td>1</td> 
      <td>0</td> 
      <td>1</td> 
      <td>1</td> 
      <td>1</td> 
      <td>1</td> 
      <td colspan="2">size</td> 
      <td>L</td> 
      <td>M</td> 
      <td colspan="4">Rm</td> 
      <td>0</td> 
      <td colspan="2">rot</td> 
      <td>1</td> 
      <td>H</td> 
      <td>0</td> 
      <td colspan="5">Rn</td> 
      <td colspan="5">Rd</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div> 
   <h4><span> (size == 01)</span></h4> 
   <a id="FCMLA_asimdelem_C_H"></a> 
   <p>FCMLA <a title="SIMD&amp;FP destination register (field &quot;Rd&quot;)" class="document-topic">&lt;Vd&gt;</a>.<a title="Arrangement specifier (field &quot;size:Q&quot;) [4H,4S,8H]" class="document-topic">&lt;T&gt;</a>, <a title="First SIMD&amp;FP source register (field &quot;Rn&quot;)" class="document-topic">&lt;Vn&gt;</a>.<a title="Arrangement specifier (field &quot;size:Q&quot;) [4H,4S,8H]" class="document-topic">&lt;T&gt;</a>, <a title="Second SIMD&amp;FP source register (field &quot;M:Rm&quot;)" class="document-topic">&lt;Vm&gt;</a>.<a title="Element size specifier (field &quot;size&quot;) [H,S]" class="document-topic">&lt;Ts&gt;</a>[<a title="Element index (field &quot;size:H:L&quot;) [H,H:L]" class="document-topic">&lt;index&gt;</a>], #<a title="Rotation (field &quot;rot&quot;) [0,90,180,270]" class="document-topic">&lt;rotate&gt;</a></p> 
  </div> 
  <div> 
   <h4><span> (size == 10)</span></h4> 
   <a id="FCMLA_asimdelem_C_S"></a> 
   <p>FCMLA <a title="SIMD&amp;FP destination register (field &quot;Rd&quot;)" class="document-topic">&lt;Vd&gt;</a>.<a title="Arrangement specifier (field &quot;size:Q&quot;) [4H,4S,8H]" class="document-topic">&lt;T&gt;</a>, <a title="First SIMD&amp;FP source register (field &quot;Rn&quot;)" class="document-topic">&lt;Vn&gt;</a>.<a title="Arrangement specifier (field &quot;size:Q&quot;) [4H,4S,8H]" class="document-topic">&lt;T&gt;</a>, <a title="Second SIMD&amp;FP source register (field &quot;M:Rm&quot;)" class="document-topic">&lt;Vm&gt;</a>.<a title="Element size specifier (field &quot;size&quot;) [H,S]" class="document-topic">&lt;Ts&gt;</a>[<a title="Element index (field &quot;size:H:L&quot;) [H,H:L]" class="document-topic">&lt;index&gt;</a>], #<a title="Rotation (field &quot;rot&quot;) [0,90,180,270]" class="document-topic">&lt;rotate&gt;</a></p> 
  </div> 
  <pre>if !<a title="function: boolean HaveFCADDExt()" class="document-topic">HaveFCADDExt</a>() then UNDEFINED;
integer d = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Rd);
integer n = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(Rn);
integer m = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(M:Rm);
integer index;
if size == '00' || size == '11' then UNDEFINED;
if size == '01' then index = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(H:L);
if size == '10' then index = <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(H);
integer esize = 8 &lt;&lt; <a title="function: integer UInt(bits(N) x)" class="document-topic">UInt</a>(size);
if !<a title="function: boolean HaveFP16Ext()" class="document-topic">HaveFP16Ext</a>() &amp;&amp; esize == 16 then UNDEFINED;
integer datasize = if Q == '1' then 128 else 64;
integer elements = datasize DIV esize;
if size == '10' &amp;&amp; (L == '1' || Q == '0') then UNDEFINED;
if size == '01' &amp;&amp; H == '1' &amp;&amp; Q=='0' then UNDEFINED;</pre> 
  <div></div> 
  <h3>Assembler Symbols</h3> 
  <div> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Vd&gt;</td> 
      <td><a id="sa_vd"></a> <p>Is the name of the SIMD&amp;FP destination register, encoded in the "Rd" field.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;T&gt;</td> 
      <td><a id="sa_t"></a> <p>Is an arrangement specifier, encoded in <q>size:Q</q>: </p> 
       <table> 
        <thead> 
         <tr> 
          <th>size</th> 
          <th>Q</th> 
          <th>&lt;T&gt;</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td>00</td> 
          <td>x</td> 
          <td>RESERVED</td> 
         </tr> 
         <tr> 
          <td>01</td> 
          <td>0</td> 
          <td>4H</td> 
         </tr> 
         <tr> 
          <td>01</td> 
          <td>1</td> 
          <td>8H</td> 
         </tr> 
         <tr> 
          <td>10</td> 
          <td>0</td> 
          <td>RESERVED</td> 
         </tr> 
         <tr> 
          <td>10</td> 
          <td>1</td> 
          <td>4S</td> 
         </tr> 
         <tr> 
          <td>11</td> 
          <td>x</td> 
          <td>RESERVED</td> 
         </tr> 
        </tbody> 
       </table> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Vn&gt;</td> 
      <td><a id="sa_vn"></a> <p>Is the name of the first SIMD&amp;FP source register, encoded in the "Rn" field.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Vm&gt;</td> 
      <td><a id="sa_vm"></a> <p>Is the name of the second SIMD&amp;FP source register, encoded in the "M:Rm" fields.</p> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;Ts&gt;</td> 
      <td><a id="sa_ts"></a> <p>Is an element size specifier, encoded in <q>size</q>: </p> 
       <table> 
        <thead> 
         <tr> 
          <th>size</th> 
          <th>&lt;Ts&gt;</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td>00</td> 
          <td>RESERVED</td> 
         </tr> 
         <tr> 
          <td>01</td> 
          <td>H</td> 
         </tr> 
         <tr> 
          <td>10</td> 
          <td>S</td> 
         </tr> 
         <tr> 
          <td>11</td> 
          <td>RESERVED</td> 
         </tr> 
        </tbody> 
       </table> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;index&gt;</td> 
      <td><a id="sa_index"></a> <p>Is the element index, encoded in <q>size:H:L</q>: </p> 
       <table> 
        <thead> 
         <tr> 
          <th>size</th> 
          <th>&lt;index&gt;</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td>00</td> 
          <td>RESERVED</td> 
         </tr> 
         <tr> 
          <td>01</td> 
          <td>H:L</td> 
         </tr> 
         <tr> 
          <td>10</td> 
          <td>H</td> 
         </tr> 
         <tr> 
          <td>11</td> 
          <td>RESERVED</td> 
         </tr> 
        </tbody> 
       </table> </td> 
     </tr> 
    </tbody> 
   </table> 
   <table> 
    <colgroup> 
     <col></col> 
     <col></col> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td>&lt;rotate&gt;</td> 
      <td><a id="sa_rotate"></a> <p>Is the rotation, encoded in <q>rot</q>: </p> 
       <table> 
        <thead> 
         <tr> 
          <th>rot</th> 
          <th>&lt;rotate&gt;</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td>00</td> 
          <td>0</td> 
         </tr> 
         <tr> 
          <td>01</td> 
          <td>90</td> 
         </tr> 
         <tr> 
          <td>10</td> 
          <td>180</td> 
         </tr> 
         <tr> 
          <td>11</td> 
          <td>270</td> 
         </tr> 
        </tbody> 
       </table> </td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div></div> 
  <div> 
   <a id="execute"></a> 
   <h3>Operation</h3> 
   <pre><a title="function: CheckFPAdvSIMDEnabled64()" class="document-topic">CheckFPAdvSIMDEnabled64</a>();
bits(datasize) operand1 = <a title="accessor: bits(width) V[integer n, integer width]" class="document-topic">V</a>[n, datasize];
bits(datasize) operand2 = <a title="accessor: bits(width) V[integer n, integer width]" class="document-topic">V</a>[m, datasize];
bits(datasize) operand3 = <a title="accessor: bits(width) V[integer n, integer width]" class="document-topic">V</a>[d, datasize];
bits(datasize) result;
<a title="type FPCRType" class="document-topic">FPCRType</a> fpcr = FPCR[];

for e = 0 to (elements DIV 2) -1
    bits(esize) element1;
    bits(esize) element2;
    bits(esize) element3;
    bits(esize) element4;
    case rot of
        when '00'
            element1 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2, esize];
            element2 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2, esize];
            element3 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2+1, esize];
            element4 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2, esize];
        when '01'
            element1 = <a title="function: bits(N) FPNeg(bits(N) op)" class="document-topic">FPNeg</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2+1, esize]);
            element2 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2+1, esize];
            element3 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2, esize];
            element4 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2+1, esize];
        when '10'
            element1 = <a title="function: bits(N) FPNeg(bits(N) op)" class="document-topic">FPNeg</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2,esize]);
            element2 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2, esize];
            element3 = <a title="function: bits(N) FPNeg(bits(N) op)" class="document-topic">FPNeg</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2+1, esize]);
            element4 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2, esize];
        when '11'
            element1 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2+1, esize];
            element2 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2+1, esize];
            element3 = <a title="function: bits(N) FPNeg(bits(N) op)" class="document-topic">FPNeg</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand2, index*2, esize]);
            element4 = <a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand1, e*2+1, esize];

    <a title="accessor: Elem[bits(N) &amp;vector, integer e, integer size] = bits(size) value" class="document-topic">Elem</a>[result, e*2,   esize] = <a title="function: bits(N) FPMulAdd(bits(N) addend, bits(N) op1, bits(N) op2, FPCRType fpcr)" class="document-topic">FPMulAdd</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand3, e*2, esize], element2, element1, fpcr);
    <a title="accessor: Elem[bits(N) &amp;vector, integer e, integer size] = bits(size) value" class="document-topic">Elem</a>[result, e*2+1, esize] = <a title="function: bits(N) FPMulAdd(bits(N) addend, bits(N) op1, bits(N) op2, FPCRType fpcr)" class="document-topic">FPMulAdd</a>(<a title="accessor: bits(size) Elem[bits(N) vector, integer e, integer size]" class="document-topic">Elem</a>[operand3, e*2+1, esize], element4, element3, fpcr);

<a title="accessor: V[integer n, integer width] = bits(width) value" class="document-topic">V</a>[d, datasize] = result;</pre> 
  </div>  
 </body>
</html>